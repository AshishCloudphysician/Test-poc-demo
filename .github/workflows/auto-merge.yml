
name: Auto Merge Master to poc-demo

on:
  push:
    branches:
      - master  # Run this workflow when master is updated

jobs:
  auto-merge:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
        with:
          fetch-depth: 0  # Fetch full history for merging

      - name: Set up Git
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"

      - name: Fetch latest changes
        run: git fetch origin  # Ensure we have the latest branches

      - name: Merge master into poc-demo with conflict resolution
        run: |
          git checkout poc-demo  # Switch to poc-demo branch
          git pull origin poc-demo  # Ensure poc-demo is up to date
          git merge origin/master || true  # Prevent failure on conflict
          git diff --name-only --diff-filter=U | while read file; do
            git checkout --theirs "$file"  # Keep master branch changes
            git add "$file"
          done
          git commit -m "Auto-resolved merge conflicts" || echo "No conflicts to resolve"

      - name: Push changes to poc-demo using PAT
        run: |
          git remote set-url origin https://x-access-token:${{ secrets.PAT }}@github.com/AshishCloudphysician/Test-poc-demo-private.git
          git push origin poc-demo || echo "No changes to push"








